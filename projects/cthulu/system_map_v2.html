<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cthulu System Map v2.0 - Exhaustive Blueprint</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-hover: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --border: #30363d;
            --hot: #e74c3c;
            --warm: #f39c12;
            --cold: #3498db;
            --disabled: #6c757d;
            --new: #27ae60;
            --accent-purple: #9b59b6;
            --accent-cyan: #00d4ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding: 2rem 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        h1 {
            color: var(--accent-purple);
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .version {
            display: inline-block;
            background: linear-gradient(135deg, #4B0082, #6A00FF);
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: bold;
            margin: 1rem 0;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-cyan);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        nav {
            background: var(--bg-card);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav a {
            color: var(--text-primary);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background 0.2s;
        }

        nav a:hover {
            background: var(--bg-hover);
        }

        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .section h2 {
            color: var(--accent-cyan);
            border-bottom: 2px solid var(--accent-cyan);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .section h3 {
            color: var(--accent-purple);
            margin: 1.5rem 0 1rem 0;
        }

        .mermaid {
            background: #1c2128;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .module-card {
            background: var(--bg-hover);
            border-radius: 8px;
            padding: 1rem;
            border-left: 4px solid var(--accent-purple);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .module-card:hover {
            transform: translateX(5px);
        }

        .module-card.hot {
            border-left-color: var(--hot);
        }

        .module-card.warm {
            border-left-color: var(--warm);
        }

        .module-card.cold {
            border-left-color: var(--cold);
        }

        .module-card.disabled {
            border-left-color: var(--disabled);
        }

        .module-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .module-stats {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .file-tree {
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
        }

        .file-item {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin: 2px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-item:hover {
            background: var(--bg-hover);
        }

        .file-path {
            color: var(--text-secondary);
        }

        .file-classes {
            color: var(--accent-cyan);
            font-size: 0.8rem;
        }

        .heat-legend {
            display: flex;
            gap: 2rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .heat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .heat-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .heat-dot.hot {
            background: var(--hot);
        }

        .heat-dot.warm {
            background: var(--warm);
        }

        .heat-dot.cold {
            background: var(--cold);
        }

        .heat-dot.disabled {
            background: var(--disabled);
        }

        .heat-dot.new {
            background: var(--new);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th,
        td {
            padding: 0.75rem;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-hover);
            color: var(--accent-cyan);
        }

        tr:nth-child(even) {
            background: #1c2128;
        }

        details {
            margin: 0.5rem 0;
        }

        summary {
            cursor: pointer;
            padding: 0.75rem;
            background: var(--bg-hover);
            border-radius: 4px;
            font-weight: bold;
        }

        summary:hover {
            background: #2d333b;
        }

        summary.hot {
            border-left: 3px solid var(--hot);
        }

        summary.warm {
            border-left: 3px solid var(--warm);
        }

        summary.cold {
            border-left: 3px solid var(--cold);
        }

        summary.disabled {
            border-left: 3px solid var(--disabled);
        }

        details[open] summary {
            border-radius: 4px 4px 0 0;
        }

        .details-content {
            padding: 1rem;
            background: #1c2128;
            border-radius: 0 0 4px 4px;
        }

        .search-box {
            width: 100%;
            padding: 1rem;
            background: var(--bg-hover);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .critical-note {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid var(--hot);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .info-note {
            background: rgba(0, 212, 255, 0.1);
            border-left: 4px solid var(--accent-cyan);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .checklist {
            list-style: none;
        }

        .checklist li {
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .done {
            color: var(--new);
        }

        .pending {
            color: var(--warm);
        }

        .gap {
            color: var(--hot);
        }

        code {
            background: var(--bg-hover);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
        }

        pre {
            background: #1c2128;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Fira Code', monospace;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üëæ Cthulu System Map v2.0</h1>
            <div class="version">EXHAUSTIVE BLUEPRINT - v5.2.0</div>
            <p style="color: var(--text-secondary);">Last Updated: 2026-01-10 | Single Source of Truth</p>
            <div class="stats-bar">
                <div class="stat">
                    <div class="stat-value">169</div>
                    <div class="stat-label">Python Files</div>
                </div>
                <div class="stat">
                    <div class="stat-value">325</div>
                    <div class="stat-label">Classes</div>
                </div>
                <div class="stat">
                    <div class="stat-value">166</div>
                    <div class="stat-label">Top-Level Functions</div>
                </div>
                <div class="stat">
                    <div class="stat-value">53,294</div>
                    <div class="stat-label">Lines of Code</div>
                </div>
                <div class="stat">
                    <div class="stat-value">28</div>
                    <div class="stat-label">Modules</div>
                </div>
            </div>
        </header>

        <nav>
            <a href="#overview">Overview</a>
            <a href="#architecture">Architecture</a>
            <a href="#modules">Module Registry</a>
            <a href="#files">File Registry</a>
            <a href="#flows">Execution Flows</a>
            <a href="#heat">Heat Map</a>
            <a href="#race">Race Conditions</a>
            <a href="#gaps">MQL5 Gaps</a>
            <a href="#checklist">Checklist</a>
        </nav>

        <!-- OVERVIEW -->
        <div class="section" id="overview">
            <h2>üìã System Overview</h2>
            <div class="info-note">
                <strong>Mission:</strong> Autonomous forex trading system with rule-based strategies enhanced by
                lightweight ML.
                Hektor integration disabled. Targeting zero fatal errors for 120+ minutes continuous operation.
            </div>

            <h3>Heat Map Legend</h3>
            <div class="heat-legend">
                <div class="heat-item">
                    <div class="heat-dot hot"></div> HOT - Every loop/signal
                </div>
                <div class="heat-item">
                    <div class="heat-dot warm"></div> WARM - Conditional execution
                </div>
                <div class="heat-item">
                    <div class="heat-dot cold"></div> COLD - Startup/rare
                </div>
                <div class="heat-item">
                    <div class="heat-dot disabled"></div> DISABLED - Feature off
                </div>
                <div class="heat-item">
                    <div class="heat-dot new"></div> NEW - Recently added
                </div>
            </div>

            <h3>Architecture Layers</h3>
            <table>
                <thead>
                    <tr>
                        <th>Layer</th>
                        <th>Name</th>
                        <th>Key Files</th>
                        <th>Heat</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>L0</td>
                        <td>Entry</td>
                        <td>__main__.py, Cthulu.py, wizard.py</td>
                        <td>üîµ COLD</td>
                    </tr>
                    <tr>
                        <td>L1</td>
                        <td>Core</td>
                        <td>bootstrap.py, trading_loop.py, shutdown.py</td>
                        <td>üî¥ HOT</td>
                    </tr>
                    <tr>
                        <td>L2</td>
                        <td>Data</td>
                        <td>data/layer.py, mt5_connector.py</td>
                        <td>üî¥ HOT</td>
                    </tr>
                    <tr>
                        <td>L3</td>
                        <td>Indicators</td>
                        <td>12 indicator files</td>
                        <td>üî¥ HOT</td>
                    </tr>
                    <tr>
                        <td>L4</td>
                        <td>Cognition</td>
                        <td>12 ML enhancement files</td>
                        <td>üü° WARM</td>
                    </tr>
                    <tr>
                        <td>L5</td>
                        <td>Strategy</td>
                        <td>7 strategies + selector</td>
                        <td>üî¥ HOT</td>
                    </tr>
                    <tr>
                        <td>L6</td>
                        <td>Risk</td>
                        <td>evaluator.py, dynamic_sltp.py</td>
                        <td>üî¥ HOT</td>
                    </tr>
                    <tr>
                        <td>L7</td>
                        <td>Position</td>
                        <td>trade_manager.py, lifecycle.py</td>
                        <td>üî¥ HOT</td>
                    </tr>
                    <tr>
                        <td>L8</td>
                        <td>Exit</td>
                        <td>16 exit strategy files</td>
                        <td>üî¥ HOT</td>
                    </tr>
                    <tr>
                        <td>L9</td>
                        <td>Execution</td>
                        <td>execution/engine.py</td>
                        <td>üî¥ HOT</td>
                    </tr>
                    <tr>
                        <td>L10</td>
                        <td>Persistence</td>
                        <td>database.py, instrumentation.py</td>
                        <td>üü° WARM</td>
                    </tr>
                    <tr>
                        <td>L11</td>
                        <td>Observability</td>
                        <td>8 monitoring/metrics files</td>
                        <td>üü° WARM</td>
                    </tr>
                    <tr>
                        <td>L12</td>
                        <td>Integrations</td>
                        <td>Hektor/vector (DISABLED)</td>
                        <td>‚ö´ DISABLED</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- ARCHITECTURE -->
        <div class="section" id="architecture">
            <h2>üèóÔ∏è Complete System Architecture</h2>
            <div class="mermaid">
                flowchart TB
                subgraph ENTRY["L0: Entry"]
                MAIN["__main__.py"]
                WIZ["wizard.py"]
                end

                subgraph CORE["L1: Core Engine"]
                BOOT["bootstrap.py"]
                LOOP["trading_loop.py"]
                SHUT["shutdown.py"]
                end

                subgraph DATA["L2: Data Layer"]
                LAYER["data/layer.py"]
                CONN["mt5_connector.py"]
                end

                subgraph IND["L3: Indicators (12)"]
                RSI["RSI"]
                ATR["ATR"]
                ADX["ADX"]
                OTHERS["MACD|BB|Stoch|..."]
                end

                subgraph COG["L4: Cognition (ML)"]
                ENGINE["engine.py"]
                REGIME["regime_classifier"]
                PREDICT["price_predictor"]
                ENTRY_C["entry_confluence"]
                end

                subgraph STRAT["L5: Strategy (7+2)"]
                SEL["strategy_selector"]
                ADAPT["selector_adapter"]
                S1["SMA|EMA|Momentum"]
                S2["Scalping|Trend|RSI"]
                end

                subgraph RISK["L6: Risk Management"]
                EVAL["evaluator.py"]
                DYN["dynamic_sltp.py"]
                ADAPT_R["adaptive_*.py"]
                end

                subgraph POS["L7: Position"]
                TM["trade_manager"]
                LIFE["lifecycle"]
                ADOPT["adoption"]
                end

                subgraph EXIT["L8: Exit System (16)"]
                COORD["coordinator"]
                TRAIL["trailing_stop"]
                EXITS["profit|time|adverse"]
                end

                subgraph EXEC["L9: Execution"]
                ENG["engine.py"]
                MT5["MT5 API"]
                end

                ENTRY --> CORE
                CORE --> DATA
                DATA --> IND
                IND --> COG
                COG --> STRAT
                STRAT --> RISK
                RISK --> POS
                POS --> EXIT
                EXIT --> EXEC
                EXEC --> MT5

                style CORE fill:#e74c3c,stroke:#c0392b,color:#fff
                style DATA fill:#e74c3c,stroke:#c0392b,color:#fff
                style IND fill:#e74c3c,stroke:#c0392b,color:#fff
                style STRAT fill:#e74c3c,stroke:#c0392b,color:#fff
                style RISK fill:#e74c3c,stroke:#c0392b,color:#fff
                style POS fill:#e74c3c,stroke:#c0392b,color:#fff
                style EXIT fill:#e74c3c,stroke:#c0392b,color:#fff
                style EXEC fill:#e74c3c,stroke:#c0392b,color:#fff
                style COG fill:#f39c12,stroke:#d68910,color:#000
                style ENTRY fill:#3498db,stroke:#2980b9,color:#fff
            </div>
        </div>

        <!-- MODULE REGISTRY -->
        <div class="section" id="modules">
            <h2>üì¶ Module Registry (28 Modules)</h2>
            <input type="text" class="search-box" id="moduleSearch" placeholder="Search modules..."
                onkeyup="filterModules()">
            <div class="module-grid" id="moduleGrid">
                <div class="module-card warm">
                    <div class="module-name">cognition/</div>
                    <div class="module-stats">12 files | 52 classes | 6,392 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">backtesting/</div>
                    <div class="module-stats">16 files | 34 classes | 5,701 lines</div>
                </div>
                <div class="module-card hot">
                    <div class="module-name">exit/</div>
                    <div class="module-stats">16 files | 41 classes | 5,190 lines</div>
                </div>
                <div class="module-card hot">
                    <div class="module-name">core/</div>
                    <div class="module-stats">8 files | 24 classes | 4,773 lines</div>
                </div>
                <div class="module-card hot">
                    <div class="module-name">risk/</div>
                    <div class="module-stats">9 files | 31 classes | 4,746 lines</div>
                </div>
                <div class="module-card disabled">
                    <div class="module-name">integrations/</div>
                    <div class="module-stats">7 files | 12 classes | 2,679 lines (DISABLED)</div>
                </div>
                <div class="module-card warm">
                    <div class="module-name">observability/</div>
                    <div class="module-stats">8 files | 9 classes | 2,532 lines</div>
                </div>
                <div class="module-card hot">
                    <div class="module-name">position/</div>
                    <div class="module-stats">8 files | 13 classes | 2,463 lines</div>
                </div>
                <div class="module-card hot">
                    <div class="module-name">indicators/</div>
                    <div class="module-stats">12 files | 19 classes | 2,393 lines</div>
                </div>
                <div class="module-card hot">
                    <div class="module-name">strategy/</div>
                    <div class="module-stats">11 files | 14 classes | 2,357 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">sentinel/</div>
                    <div class="module-stats">9 files | 7 classes | 1,737 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">config/</div>
                    <div class="module-stats">4 files | 1 class | 1,694 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">rpc/</div>
                    <div class="module-stats">2 files | 13 classes | 1,530 lines</div>
                </div>
                <div class="module-card warm">
                    <div class="module-name">monitoring/</div>
                    <div class="module-stats">4 files | 5 classes | 1,260 lines</div>
                </div>
                <div class="module-card warm">
                    <div class="module-name">utils/</div>
                    <div class="module-stats">7 files | 7 classes | 1,061 lines</div>
                </div>
                <div class="module-card hot">
                    <div class="module-name">execution/</div>
                    <div class="module-stats">2 files | 5 classes | 982 lines</div>
                </div>
                <div class="module-card warm">
                    <div class="module-name">persistence/</div>
                    <div class="module-stats">2 files | 3 classes | 896 lines</div>
                </div>
                <div class="module-card hot">
                    <div class="module-name">connector/</div>
                    <div class="module-stats">2 files | 2 classes | 835 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">ui/</div>
                    <div class="module-stats">2 files | 1 class | 776 lines</div>
                </div>
                <div class="module-card warm">
                    <div class="module-name">training/</div>
                    <div class="module-stats">2 files | 5 classes | 674 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">cthulu/</div>
                    <div class="module-stats">4 files | 2 classes | 629 lines</div>
                </div>
                <div class="module-card warm">
                    <div class="module-name">news/</div>
                    <div class="module-stats">9 files | 9 classes | 441 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">market/</div>
                    <div class="module-stats">2 files | 6 classes | 438 lines</div>
                </div>
                <div class="module-card warm">
                    <div class="module-name">data/</div>
                    <div class="module-stats">2 files | 1 class | 374 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">advisory/</div>
                    <div class="module-stats">1 file | 1 class | 192 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">ops/</div>
                    <div class="module-stats">2 files | 1 class | 134 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">herald/</div>
                    <div class="module-stats">1 file | 0 classes | 11 lines</div>
                </div>
                <div class="module-card cold">
                    <div class="module-name">root/</div>
                    <div class="module-stats">5 files | 7 classes | 404 lines</div>
                </div>
            </div>
        </div>

        <!-- FILE REGISTRY -->
        <div class="section" id="files">
            <h2>üìÅ Complete File Registry (169 Files)</h2>
            <input type="text" class="search-box" id="fileSearch" placeholder="Search files, classes, functions..."
                onkeyup="filterFiles()">
            <div id="fileRegistry">
                <details>
                    <summary class="hot">core/ (8 files, 4,773 lines)</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">core/__init__.py</span><span
                                    class="file-classes">-</span></div>
                            <div class="file-item"><span class="file-path">core/bootstrap.py</span><span
                                    class="file-classes">TradingSystemBootstrap</span></div>
                            <div class="file-item"><span class="file-path">core/exceptions.py</span><span
                                    class="file-classes">ChuluException, ConfigError, +3 more</span></div>
                            <div class="file-item"><span class="file-path">core/exit_loader.py</span><span
                                    class="file-classes">ExitStrategyLoader</span></div>
                            <div class="file-item"><span class="file-path">core/indicator_loader.py</span><span
                                    class="file-classes">IndicatorLoader, IndicatorRequirements</span></div>
                            <div class="file-item"><span class="file-path">core/shutdown.py</span><span
                                    class="file-classes">GracefulShutdown</span></div>
                            <div class="file-item"><span class="file-path">core/strategy_factory.py</span><span
                                    class="file-classes">StrategyFactory</span></div>
                            <div class="file-item"><span class="file-path">core/trading_loop.py</span><span
                                    class="file-classes">TradingLoop, TradingLoopContext</span></div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary class="hot">strategy/ (11 files, 2,357 lines)</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">strategy/base.py</span><span
                                    class="file-classes">Strategy, Signal, SignalType</span></div>
                            <div class="file-item"><span class="file-path">strategy/sma_crossover.py</span><span
                                    class="file-classes">SMACrossoverStrategy</span></div>
                            <div class="file-item"><span class="file-path">strategy/ema_crossover.py</span><span
                                    class="file-classes">EMACrossoverStrategy</span></div>
                            <div class="file-item"><span class="file-path">strategy/momentum_breakout.py</span><span
                                    class="file-classes">MomentumBreakoutStrategy</span></div>
                            <div class="file-item"><span class="file-path">strategy/scalping.py</span><span
                                    class="file-classes">ScalpingStrategy</span></div>
                            <div class="file-item"><span class="file-path">strategy/mean_reversion.py</span><span
                                    class="file-classes">MeanReversionStrategy</span></div>
                            <div class="file-item"><span class="file-path">strategy/trend_following.py</span><span
                                    class="file-classes">TrendFollowingStrategy</span></div>
                            <div class="file-item"><span class="file-path">strategy/rsi_reversal.py</span><span
                                    class="file-classes">RSIReversalStrategy</span></div>
                            <div class="file-item"><span class="file-path">strategy/strategy_selector.py</span><span
                                    class="file-classes">StrategySelector, MarketRegime</span></div>
                            <div class="file-item"><span class="file-path">strategy/selector_adapter.py</span><span
                                    class="file-classes">StrategySelectorAdapter</span></div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary class="hot">indicators/ (12 files, 2,393 lines)</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">indicators/base.py</span><span
                                    class="file-classes">Indicator (ABC)</span></div>
                            <div class="file-item"><span class="file-path">indicators/rsi.py</span><span
                                    class="file-classes">RSI</span></div>
                            <div class="file-item"><span class="file-path">indicators/atr.py</span><span
                                    class="file-classes">ATR</span></div>
                            <div class="file-item"><span class="file-path">indicators/adx.py</span><span
                                    class="file-classes">ADX</span></div>
                            <div class="file-item"><span class="file-path">indicators/macd.py</span><span
                                    class="file-classes">MACD</span></div>
                            <div class="file-item"><span class="file-path">indicators/bollinger.py</span><span
                                    class="file-classes">BollingerBands</span></div>
                            <div class="file-item"><span class="file-path">indicators/stochastic.py</span><span
                                    class="file-classes">Stochastic</span></div>
                            <div class="file-item"><span class="file-path">indicators/supertrend.py</span><span
                                    class="file-classes">Supertrend</span></div>
                            <div class="file-item"><span class="file-path">indicators/vwap.py</span><span
                                    class="file-classes">VWAP, AnchoredVWAP</span></div>
                            <div class="file-item"><span class="file-path">indicators/volume_indicators.py</span><span
                                    class="file-classes">VolumeIndicators</span></div>
                            <div class="file-item"><span class="file-path">indicators/market_structure.py</span><span
                                    class="file-classes">MarketStructureDetector, BOS/ChoCH</span></div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary class="warm">cognition/ (12 files, 6,392 lines)</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">cognition/engine.py</span><span
                                    class="file-classes">CognitionEngine, CognitionState</span></div>
                            <div class="file-item"><span class="file-path">cognition/regime_classifier.py</span><span
                                    class="file-classes">MarketRegimeClassifier, RegimeState</span></div>
                            <div class="file-item"><span class="file-path">cognition/price_predictor.py</span><span
                                    class="file-classes">PricePredictor, PricePrediction</span></div>
                            <div class="file-item"><span class="file-path">cognition/sentiment_analyzer.py</span><span
                                    class="file-classes">SentimentAnalyzer, SentimentScore</span></div>
                            <div class="file-item"><span class="file-path">cognition/exit_oracle.py</span><span
                                    class="file-classes">ExitOracle, ExitSignal</span></div>
                            <div class="file-item"><span class="file-path">cognition/entry_confluence.py</span><span
                                    class="file-classes">EntryConfluenceFilter, EntryQuality</span></div>
                            <div class="file-item"><span class="file-path">cognition/structure_detector.py</span><span
                                    class="file-classes">StructureDetector, StructureSignal</span></div>
                            <div class="file-item"><span class="file-path">cognition/pattern_recognition.py</span><span
                                    class="file-classes">PatternRecognition (HEKTOR)</span></div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary class="hot">risk/ (9 files, 4,746 lines)</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">risk/manager.py</span><span
                                    class="file-classes">RiskManager</span></div>
                            <div class="file-item"><span class="file-path">risk/evaluator.py</span><span
                                    class="file-classes">RiskEvaluator, RiskDecision</span></div>
                            <div class="file-item"><span class="file-path">risk/dynamic_sltp.py</span><span
                                    class="file-classes">DynamicSLTP</span></div>
                            <div class="file-item"><span class="file-path">risk/adaptive_account_manager.py</span><span
                                    class="file-classes">AdaptiveAccountManager</span></div>
                            <div class="file-item"><span class="file-path">risk/adaptive_drawdown.py</span><span
                                    class="file-classes">AdaptiveDrawdown</span></div>
                            <div class="file-item"><span class="file-path">risk/equity_curve_manager.py</span><span
                                    class="file-classes">EquityCurveManager</span></div>
                            <div class="file-item"><span class="file-path">risk/liquidity_trap_detector.py</span><span
                                    class="file-classes">LiquidityTrapDetector</span></div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary class="hot">exit/ (16 files, 5,190 lines)</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">exit/base.py</span><span
                                    class="file-classes">ExitStrategy (ABC)</span></div>
                            <div class="file-item"><span class="file-path">exit/coordinator.py</span><span
                                    class="file-classes">ExitCoordinator</span></div>
                            <div class="file-item"><span class="file-path">exit/confluence_exit_manager.py</span><span
                                    class="file-classes">ConfluenceExitManager</span></div>
                            <div class="file-item"><span class="file-path">exit/trailing_stop.py</span><span
                                    class="file-classes">TrailingStopExit</span></div>
                            <div class="file-item"><span class="file-path">exit/profit_target.py</span><span
                                    class="file-classes">ProfitTargetExit</span></div>
                            <div class="file-item"><span class="file-path">exit/stop_loss.py</span><span
                                    class="file-classes">StopLossExit</span></div>
                            <div class="file-item"><span class="file-path">exit/time_based.py</span><span
                                    class="file-classes">TimeBasedExit</span></div>
                            <div class="file-item"><span class="file-path">exit/adverse_movement.py</span><span
                                    class="file-classes">AdverseMovementExit</span></div>
                            <div class="file-item"><span class="file-path">exit/multi_rrr.py</span><span
                                    class="file-classes">MultiRRR (EXPERIMENTAL)</span></div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary class="hot">position/ (8 files, 2,463 lines)</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">position/manager.py</span><span
                                    class="file-classes">PositionManager</span></div>
                            <div class="file-item"><span class="file-path">position/trade_manager.py</span><span
                                    class="file-classes">TradeManager</span></div>
                            <div class="file-item"><span class="file-path">position/lifecycle.py</span><span
                                    class="file-classes">PositionLifecycle</span></div>
                            <div class="file-item"><span class="file-path">position/adoption.py</span><span
                                    class="file-classes">TradeAdoption</span></div>
                            <div class="file-item"><span class="file-path">position/tracker.py</span><span
                                    class="file-classes">PositionTracker</span></div>
                            <div class="file-item"><span class="file-path">position/profit_scaler.py</span><span
                                    class="file-classes">ProfitScaler</span></div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary class="hot">execution/ + connector/ (4 files, 1,817 lines)</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">execution/engine.py</span><span
                                    class="file-classes">ExecutionEngine</span></div>
                            <div class="file-item"><span class="file-path">connector/mt5_connector.py</span><span
                                    class="file-classes">MT5Connector</span></div>
                        </div>
                    </div>
                </details>

                <details>
                    <summary class="disabled">integrations/ (7 files, 2,679 lines) - HEKTOR DISABLED</summary>
                    <div class="details-content">
                        <div class="file-tree">
                            <div class="file-item"><span class="file-path">integrations/vector_studio.py</span><span
                                    class="file-classes">VectorStudioAdapter (DISABLED)</span></div>
                            <div class="file-item"><span class="file-path">integrations/embedder.py</span><span
                                    class="file-classes">Embedder (DISABLED)</span></div>
                            <div class="file-item"><span class="file-path">integrations/retriever.py</span><span
                                    class="file-classes">Retriever (DISABLED)</span></div>
                            <div class="file-item"><span class="file-path">integrations/ml_exporter.py</span><span
                                    class="file-classes">MLDataExporter (DISABLED)</span></div>
                        </div>
                    </div>
                </details>
            </div>
        </div>

        <!-- EXECUTION FLOWS -->
        <div class="section" id="flows">
            <h2>‚ö° Execution Flows</h2>
            <h3>Signal-to-Execution Pipeline</h3>
            <div class="mermaid">
                flowchart LR
                S1["Strategy Signal"] --> C1["Cognition Enhancement"]
                C1 --> Q1["Entry Confluence"]
                Q1 --> R1["Risk Evaluator"]
                R1 --> E1["Execution Engine"]
                E1 --> MT5["MT5 API"]
                Q1 -.->|REJECT| X["‚ùå"]
                R1 -.->|BLOCK| X
                style Q1 fill:#00d4ff,stroke:#00a8cc
                style R1 fill:#e74c3c,stroke:#c0392b,color:#fff
                style E1 fill:#27ae60,stroke:#1e8449,color:#fff
            </div>

            <h3>Exit Decision Flow</h3>
            <div class="mermaid">
                flowchart TB
                POS["Position"] --> EXIT["Exit Strategies"]
                EXIT --> COORD["Coordinator"]
                COORD --> D{"Score?"}
                D -->|"< 0.55"| HOLD["HOLD"] D -->|"0.55-0.74"| SCALE["SCALE_OUT"]
                    D -->|">= 0.75"| CLOSE["CLOSE_NOW"]
                    style COORD fill:#f39c12,stroke:#d68910
            </div>

            <h3>Dynamic SL/TP Flow</h3>
            <div class="mermaid">
                flowchart TB
                START["Position"] --> PROFIT{"Profit > 0?"}
                PROFIT -->|No| NORMAL["NORMAL: SL = entry ¬± 2√óATR"]
                PROFIT -->|Yes| BE{"Profit > BE?"}
                BE -->|No| NORMAL
                BE -->|Yes| BREAK["BREAKEVEN: SL ‚Üí Entry"]
                BREAK --> TRAIL{"Profit > trail?"}
                TRAIL -->|No| BREAK
                TRAIL -->|Yes| TRAILING["TRAILING: Lock 50%"]
                style NORMAL fill:#3498db
                style BREAK fill:#f39c12
                style TRAILING fill:#27ae60
            </div>
        </div>

        <!-- HEAT MAP -->
        <div class="section" id="heat">
            <h2>üî• Execution Heat Map</h2>
            <table>
                <thead>
                    <tr>
                        <th>Module</th>
                        <th>Heat</th>
                        <th>Trigger</th>
                        <th>Frequency</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>core/trading_loop.py</td>
                        <td>üî¥ HOT</td>
                        <td>Main loop</td>
                        <td>Every poll (1-5s)</td>
                    </tr>
                    <tr>
                        <td>connector/mt5_connector.py</td>
                        <td>üî¥ HOT</td>
                        <td>API calls</td>
                        <td>Every loop</td>
                    </tr>
                    <tr>
                        <td>indicators/*.py</td>
                        <td>üî¥ HOT</td>
                        <td>calculate()</td>
                        <td>Every bar</td>
                    </tr>
                    <tr>
                        <td>strategy/*.py</td>
                        <td>üî¥ HOT</td>
                        <td>on_bar()</td>
                        <td>Every bar</td>
                    </tr>
                    <tr>
                        <td>risk/evaluator.py</td>
                        <td>üî¥ HOT</td>
                        <td>Every signal</td>
                        <td>On signal</td>
                    </tr>
                    <tr>
                        <td>risk/dynamic_sltp.py</td>
                        <td>üî¥ HOT</td>
                        <td>Every position</td>
                        <td>Continuous</td>
                    </tr>
                    <tr>
                        <td>exit/coordinator.py</td>
                        <td>üî¥ HOT</td>
                        <td>Every position</td>
                        <td>Continuous</td>
                    </tr>
                    <tr>
                        <td>cognition/engine.py</td>
                        <td>üü° WARM</td>
                        <td>On signal</td>
                        <td>Conditional</td>
                    </tr>
                    <tr>
                        <td>news/manager.py</td>
                        <td>üü° WARM</td>
                        <td>Periodic</td>
                        <td>Every 5-15 min</td>
                    </tr>
                    <tr>
                        <td>integrations/*.py</td>
                        <td>‚ö´ DISABLED</td>
                        <td>Never</td>
                        <td>Hektor disabled</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- RACE CONDITIONS -->
        <div class="section" id="race">
            <h2>‚ö†Ô∏è Race Condition Matrix</h2>
            <div class="critical-note"><strong>Known Race Conditions:</strong></div>
            <table>
                <thead>
                    <tr>
                        <th>Module A</th>
                        <th>Module B</th>
                        <th>Conflict</th>
                        <th>Resolution</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>dynamic_sltp</td>
                        <td>trailing_stop</td>
                        <td>SL modification</td>
                        <td>trailing in-memory, sltp does MT5</td>
                    </tr>
                    <tr>
                        <td>trade_manager</td>
                        <td>adoption</td>
                        <td>Position ownership</td>
                        <td>magic_number check</td>
                    </tr>
                    <tr>
                        <td>trade_manager</td>
                        <td>database</td>
                        <td>DB write</td>
                        <td>WAL mode + locking</td>
                    </tr>
                    <tr>
                        <td>strategy_selector</td>
                        <td>selector_adapter</td>
                        <td>Strategy dispatch</td>
                        <td>adapter wraps selector (fixed 2026-01-10)</td>
                    </tr>
                </tbody>
            </table>
            <h3>Dead Code Candidates</h3>
            <ul class="checklist">
                <li class="gap">‚ö´ exit/multi_rrr*.py - Experimental</li>
                <li class="gap">‚ö´ integrations/* - Hektor disabled</li>
                <li class="gap">‚ö´ cognition/pattern_recognition.py - Hektor dependent</li>
            </ul>
        </div>

        <!-- MQL5 GAPS -->
        <div class="section" id="gaps">
            <h2>üìö MQL5 Handbook Gap Analysis</h2>
            <table>
                <thead>
                    <tr>
                        <th>Feature</th>
                        <th>Handbook</th>
                        <th>Status</th>
                        <th>Priority</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>BOS/ChoCH Detection</td>
                        <td>Phase 3</td>
                        <td class="done">‚úÖ Implemented</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>Risk Management</td>
                        <td>Phase 2</td>
                        <td class="done">‚úÖ Implemented</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>Exit Strategies</td>
                        <td>Phase 2</td>
                        <td class="done">‚úÖ 16 files</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td>Volume Profile (VPVR)</td>
                        <td>Phase 3</td>
                        <td class="gap">‚ùå GAP</td>
                        <td>HIGH</td>
                    </tr>
                    <tr>
                        <td>Opening Range Breakout</td>
                        <td>Phase 3</td>
                        <td class="gap">‚ùå GAP</td>
                        <td>HIGH</td>
                    </tr>
                    <tr>
                        <td>Candle Range Theory</td>
                        <td>Phase 3</td>
                        <td class="gap">‚ùå GAP</td>
                        <td>HIGH</td>
                    </tr>
                    <tr>
                        <td>Heikin Ashi</td>
                        <td>Phase 2</td>
                        <td class="gap">‚ùå GAP</td>
                        <td>MEDIUM</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- CHECKLIST -->
        <div class="section" id="checklist">
            <h2>‚úÖ Feature Checklist</h2>
            <h3>Core Trading</h3>
            <ul class="checklist">
                <li class="done">‚úÖ MT5 Connection & API</li>
                <li class="done">‚úÖ 7 Trading Strategies</li>
                <li class="done">‚úÖ Dynamic Strategy Selection</li>
                <li class="done">‚úÖ 12 Technical Indicators</li>
                <li class="done">‚úÖ Risk Management</li>
                <li class="done">‚úÖ Dynamic SL/TP</li>
                <li class="done">‚úÖ 16 Exit Strategies</li>
                <li class="done">‚úÖ Trade Adoption</li>
            </ul>
            <h3>ML/Cognition</h3>
            <ul class="checklist">
                <li class="done">‚úÖ Regime Classifier</li>
                <li class="done">‚úÖ Price Predictor</li>
                <li class="done">‚úÖ Entry Confluence</li>
                <li class="done">‚úÖ BOS/ChoCH Detection</li>
                <li class="gap">‚ùå Pattern Recognition (Hektor)</li>
            </ul>
            <h3>Pending</h3>
            <ul class="checklist">
                <li class="gap">‚ùå Volume Profile (VPVR)</li>
                <li class="gap">‚ùå Opening Range Breakout</li>
                <li class="gap">‚ùå Candle Range Theory</li>
                <li class="gap">‚ùå Heikin Ashi</li>
            </ul>
        </div>

        <footer
            style="text-align: center; padding: 2rem; color: var(--text-secondary); border-top: 1px solid var(--border); margin-top: 2rem;">
            <p>Cthulu System Map v2.0 | Generated: 2026-01-10</p>
            <p>169 Files | 325 Classes | 53,294 Lines | 28 Modules</p>
        </footer>
    </div>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
        function filterModules() {
            const q = document.getElementById('moduleSearch').value.toLowerCase();
            document.querySelectorAll('.module-card').forEach(c => {
                c.style.display = c.textContent.toLowerCase().includes(q) ? 'block' : 'none';
            });
        }
        function filterFiles() {
            const q = document.getElementById('fileSearch').value.toLowerCase();
            document.querySelectorAll('#fileRegistry details').forEach(d => {
                d.style.display = d.textContent.toLowerCase().includes(q) ? 'block' : 'none';
            });
        }
    </script>
</body>

</html>